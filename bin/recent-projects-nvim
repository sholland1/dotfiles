#!/bin/bash

RESULT=$(find ~/Projects -maxdepth 1 -type d |
  tail -n +2 |
  while read -r dir; do
    date=0
    if [ -f "$dir/Session.vim" ]; then
      date=$(stat -c "%Y" "$dir/Session.vim")
    fi
    echo "$date $dir"
  done |
  sort -rn |
  cut -d' ' -f2- |
  fzf --preview 'eza --color=always --icons=always --group-directories-first --tree --git-ignore {}' \
      --preview-window='right,50%,<40(down,80%)')

if [ -z "$RESULT" ]; then
  exit
fi

cd "$RESULT" || exit
set -m
$TERM -T "$RESULT" -e open-in-editor &
disown
