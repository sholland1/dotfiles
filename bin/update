#!/bin/bash
echo 'Initiating system update...'

echo 'Updating mirrors...'
export TMPFILE="$(mktemp)"; \
    sudo true; \
    rate-mirrors --save=$TMPFILE arch --max-delay=21600 \
      && sudo mv /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist-backup \
      && sudo mv $TMPFILE /etc/pacman.d/mirrorlist \
      && ua-drop-caches

echo 'Performing system update...'
yay -Syu --cleanmenu=false --diffmenu=false --editmenu=false --removemake

echo 'Cleaning caches...'
paccache -rk1
paccache -ruk0
yay -Sc --aur --noconfirm

echo 'Resetting keyboard settings...'
xset s off -dpms &
xset r rate 250 80 &
setxkbmap -option caps:swapescape &

echo 'Updating Neovim...'
nvim --headless '+Lazy! sync' +MasonToolsUpdateSync +qa

echo 'Updating VS Code extensions...'
code --update-extensions

echo 'Updating database for plocate...'
sudo updatedb

read -n1 -sp 'Press any key to exit...'
